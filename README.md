# Утилита восстановления графической подсистемы (v1.4)

## Назначение
PowerShell-скрипт для восстановления графической подсистемы Windows на локальных и удаленных компьютерах. Решает проблемы с зависанием интерфейса, графическими артефактами и неработающим рабочим столом. Поддерживает как единичные компьютеры, так и массовое применение в корпоративных средах.

## Основные возможности
- **Три метода восстановления**: Перезапуск DWM, Explorer и отправка системных клавиш
- **Умный выбор доступа**: Автоматическое определение оптимального метода подключения (WMI, PsExec, WinRM)
- **Два режима работы**: Быстрый (только DWM) и полный (все три метода)
- **Автоматическое повышение прав**: Самоперезапуск с правами администратора
- **Детальная диагностика**: Проверка доступности компьютера перед выполнением
- **Кросс-платформенность**: Поддержка Windows 7/8/10/11 и Windows Server
- **Наглядное логирование**: Цветная индикация статуса операций

## Требования
- **ОС**: Windows 7+ / Windows Server 2008 R2+
- **PowerShell**: Версия 3.0+
- **Права**: Локальные административные права
- **Для удаленного доступа**:
  - Доступ хотя бы к одному протоколу: WMI (порт 135), PsExec или WinRM
  - Сетевой доступ к целевым компьютерам

## Инструкция по использованию

### Базовый запуск
```powershell
powershell.exe -ExecutionPolicy Bypass -File "restart_display.ps1"
```
(рекомендуется создать ярлык с параметрами: `C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -ExecutionPolicy Bypass -File "\\путь_к_скрипту\restart_display.ps1"`)

### Параметры запуска
| Параметр        | Описание                                  | Пример использования                     |
|-----------------|-------------------------------------------|------------------------------------------|
| `-ComputerName` | Восстановление на удаленном компьютере    | `.\restart_display.ps1 -ComputerName WS-025` |
| `-FullRestore`  | Полный режим восстановления (3 метода)   | `.\restart_display.ps1 -FullRestore`     |

### Примеры использования
```powershell
# Локальное восстановление (только DWM)
.\restart_display.ps1

# Удаленное восстановление в полном режиме
.\restart_display.ps1 -ComputerName WS-012 -FullRestore

# Массовое восстановление списка компьютеров
"WS-011", "WS-012", "WS-013" | ForEach-Object {
    .\restart_display.ps1 -ComputerName $_ -FullRestore
}
```

## Технические детали

### Методы восстановления
1. **Перезапуск DWM (Desktop Window Manager)**  
   - Принудительное завершение и перезапуск процесса dwm.exe
   - Решает проблемы с графическими артефактами и зависаниями

2. **Системная комбинация клавиш (Ctrl+Win+Shift+B)**  
   - Перезапуск видеодрайвера без перезагрузки
   - Эффективно при проблемах с драйверами видеокарты

3. **Перезапуск Explorer**  
   - Восстановление рабочего стола и панели задач
   - Решает проблемы с исчезновением иконок и зависанием интерфейса

### Приоритет методов доступа
1. **WMI**  
   - Используется по умолчанию, если доступен
   - Требует открытых портов 135 и динамического RPC-диапазона

2. **PsExec**  
   - Автоматически используется при наличии psexec.exe в PATH
   - Не требует предварительной настройки целевой системы

3. **WinRM**  
   - Используется при включенном PowerShell Remoting
   - Требует предварительной настройки на целевых компьютерах

### Логирование операций
- Цветная индикация статуса (INFO/SUCCESS/ERROR)
- Детальное описание каждого этапа выполнения
- Пауза перед завершением для просмотра результатов

## Важные примечания
1. Для работы через **WinRM** должна быть включена соответствующая конфигурация:
   ```powershell
   Enable-PSRemoting -Force
   Set-NetFirewallRule -Name "WINRM-HTTP-In-TCP" -RemoteAddress Any
   ```

2. Для использования **PsExec**:
   - Скачайте [PsExec](https://learn.microsoft.com/ru-ru/sysinternals/downloads/psexec)
   - Поместите psexec.exe в системный PATH или в папку со скриптом

3. При работе в **полном режиме**:
   - Последовательно применяются все три метода восстановления
   - Между операциями выдерживается пауза 10000 мс
   - Скрипт завершается при первом успешном методе

4. Особенности работы:
   - При удаленном выполнении возможны кратковременные мерцания экрана
   - Не влияет на запущенные приложения и пользовательские данные
   - Рекомендуется предупреждать пользователей о выполнении операции

## Поддержка
Для отчетов об ошибках или предложений по улучшению обращайтесь к разработчику.  

Copyright © 2025 Кодельник Максим Сергеевич | MIT License  
Версия: 1.4 (2025-08-04)
